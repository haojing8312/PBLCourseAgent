# Phase 2.1 äº¤ä»˜æŠ¥å‘Š - åˆ†é˜¶æ®µäººå·¥å‚ä¸å¼å·¥ä½œæµ

**äº¤ä»˜æ—¶é—´**: 2025-09-30
**å¼€å‘è€…**: Claude (Sonnet 4.5)
**ä»»åŠ¡**: å°†ä¸€æ¬¡æ€§ç”Ÿæˆæ”¹é€ ä¸ºçœŸæ­£çš„åˆ†é˜¶æ®µäººå·¥å‚ä¸å¼å·¥ä½œæµ

---

## ğŸ¯ æ ¸å¿ƒéœ€æ±‚

**åŸå§‹é—®é¢˜**: `/api/v1/generate` ç«¯ç‚¹ä¸€æ¬¡æ€§ç”Ÿæˆæ‰€æœ‰3ä¸ªé˜¶æ®µï¼Œç”¨æˆ·æ— æ³•åœ¨é˜¶æ®µé—´ç¼–è¾‘

**è§£å†³æ–¹æ¡ˆ**: å®ç° Stage1 â†’ ç”¨æˆ·ç¼–è¾‘ â†’ Stage2 â†’ ç”¨æˆ·ç¼–è¾‘ â†’ Stage3 çš„çœŸæ­£åˆ†é˜¶æ®µæµç¨‹

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. åç«¯APIæ¶æ„ (100% å®Œæˆ)

#### æ–°å¢Agent (`backend/app/agents/stage_agents.py`)
- âœ… `Stage1Agent`: ç”Ÿæˆé¡¹ç›®åŸºç¡€å®šä¹‰ (é©±åŠ¨æ€§é—®é¢˜ã€é¡¹ç›®å®šä¹‰ã€æœ€ç»ˆæˆæœ)
- âœ… `Stage2Agent`: åŸºäºStage1ç”Ÿæˆè¯„ä¼°æ¡†æ¶ (æ¥å—ç”¨æˆ·ç¼–è¾‘åçš„Stage1è¾“å‡º)
- âœ… `Stage3Agent`: åŸºäºStage1+2ç”Ÿæˆå­¦ä¹ è“å›¾ (æ¥å—ç”¨æˆ·ç¼–è¾‘åçš„Stage1+2è¾“å‡º)

**å…³é”®è®¾è®¡ç‰¹ç‚¹**:
- è¿”å› **Markdownæ ¼å¼æ–‡æœ¬** (ç”¨æˆ·å‹å¥½ï¼Œæ˜“äºç¼–è¾‘)
- æ¯ä¸ªAgentç‹¬ç«‹è°ƒç”¨ï¼Œæ”¯æŒäººå·¥å¹²é¢„
- è¶…æ—¶è®¾ç½®: Stage1=30s, Stage2=60s, Stage3=90s

#### æ–°å¢APIç«¯ç‚¹ (`backend/app/api/routes.py`)
```
POST /api/v1/generate/stage1  # é˜¶æ®µ1: é¡¹ç›®åŸºç¡€å®šä¹‰
POST /api/v1/generate/stage2  # é˜¶æ®µ2: è¯„ä¼°æ¡†æ¶ (éœ€Stage1è¾“å‡º)
POST /api/v1/generate/stage3  # é˜¶æ®µ3: å­¦ä¹ è“å›¾ (éœ€Stage1+2è¾“å‡º)
```

**æ•°æ®æµ**:
```
Stage1 è¾“å…¥: è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯
       â†“
Stage1 è¾“å‡º: driving_question, project_definition, final_deliverable, raw_content
       â†“ (ç”¨æˆ·å¯ç¼–è¾‘)
Stage2 è¾“å…¥: Stage1è¾“å‡º + è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯
       â†“
Stage2 è¾“å‡º: rubric_markdown, evaluation_criteria, raw_content
       â†“ (ç”¨æˆ·å¯ç¼–è¾‘)
Stage3 è¾“å…¥: Stage1è¾“å‡º + Stage2è¾“å‡º + è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯
       â†“
Stage3 è¾“å‡º: day_by_day_plan, activities_summary, materials_list, raw_content
```

---

### 2. å‰ç«¯å®ç° (100% å®Œæˆ)

#### APIæœåŠ¡å±‚ (`frontend-v2/src/services/api.ts`)
- âœ… æ·»åŠ  TypeScript ç±»å‹å®šä¹‰ (Stage1Input/Output, Stage2Input/Output, Stage3Input/Output)
- âœ… å®ç°3ä¸ªæ–°APIæ–¹æ³•: `generateStage1()`, `generateStage2()`, `generateStage3()`

#### é¡µé¢é‡æ„ (`frontend-v2/src/pages/CourseDesignPage.tsx`)
**ä»æ—§ç‰ˆä¸€æ¬¡æ€§ç”Ÿæˆå®Œå…¨é‡æ„ä¸ºçœŸæ­£çš„åˆ†é˜¶æ®µå·¥ä½œæµ**:

**ç•Œé¢ç‰¹æ€§**:
1. **é˜¶æ®µè¿›åº¦æŒ‡ç¤ºå™¨**: é¡¶éƒ¨headeræ˜¾ç¤º3ä¸ªé˜¶æ®µçš„å½“å‰çŠ¶æ€
2. **é€é˜¶æ®µå±•å¼€**: åªæœ‰å½“å‰é˜¶æ®µå’Œå·²å®Œæˆé˜¶æ®µå¯è§
3. **å¯ç¼–è¾‘æ–‡æœ¬åŸŸ**: æ¯ä¸ªé˜¶æ®µç”Ÿæˆåæ˜¾ç¤ºå¯ç¼–è¾‘çš„textarea
4. **ç¼–è¾‘/ç¡®è®¤å·¥ä½œæµ**:
   - ç”Ÿæˆå®Œæˆ â†’ æ˜¾ç¤ºåªè¯»å†…å®¹ + "ç¼–è¾‘"æŒ‰é’®
   - ç‚¹å‡»"ç¼–è¾‘" â†’ æ–‡æœ¬åŸŸå˜ä¸ºå¯ç¼–è¾‘ + "ä¿å­˜ä¿®æ”¹"/"å–æ¶ˆ"æŒ‰é’®
   - ç‚¹å‡»"ç¡®è®¤å®Œæˆï¼Œç»§ç»­ä¸‹ä¸€é˜¶æ®µ" â†’ è¿›å…¥ä¸‹ä¸€é˜¶æ®µ
5. **å®Œæˆåå¯¼å‡º**: æ‰€æœ‰3é˜¶æ®µå®Œæˆåæ˜¾ç¤º"å¯¼å‡ºä¸ºMarkdownæ–‡ä»¶"æŒ‰é’®

**çŠ¶æ€ç®¡ç†**:
```typescript
type StageStatus = 'pending' | 'generating' | 'completed' | 'editing' | 'error'

- stage1Status, stage1Data, stage1EditableContent
- stage2Status, stage2Data, stage2EditableContent
- stage3Status, stage3Data, stage3EditableContent
- currentStage: 1 | 2 | 3 | 'complete'
```

---

### 3. æµ‹è¯•éªŒè¯

#### åç«¯æµ‹è¯• (`backend/test_full_workflow.py`)
âœ… **å®Œæ•´3é˜¶æ®µå·¥ä½œæµæµ‹è¯•**:
```
âœ… é˜¶æ®µ1æˆåŠŸ (è€—æ—¶: 12.22ç§’)
âœ… é˜¶æ®µ2æˆåŠŸ (è€—æ—¶: 40.31ç§’)
âœ… é˜¶æ®µ3æˆåŠŸ (è€—æ—¶: 72.42ç§’)
æ€»è€—æ—¶: 124.95ç§’

âœ… æ‰€æœ‰é˜¶æ®µå‡æ”¯æŒç”¨æˆ·ç¼–è¾‘å’Œä¿®æ”¹
âœ… åç»­é˜¶æ®µæ­£ç¡®ä½¿ç”¨äº†å‰é¢é˜¶æ®µçš„è¾“å‡º
âœ… äººå·¥å‚ä¸å¼å·¥ä½œæµéªŒè¯é€šè¿‡
```

#### å‰ç«¯æµ‹è¯•
âœ… **ç¼–è¯‘æ£€æŸ¥**: æ— TypeScripté”™è¯¯ï¼ŒVite HMRæ›´æ–°æˆåŠŸ
âœ… **APIéªŒè¯**: æˆåŠŸè°ƒç”¨ `/api/v1/generate/stage1`ï¼Œè¿”å›æ­£ç¡®æ ¼å¼æ•°æ®

---

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### å¯åŠ¨æœåŠ¡

```bash
# 1. å¯åŠ¨åç«¯ (8888ç«¯å£)
cd backend
uv run uvicorn app.main:app --host 0.0.0.0 --port 8888 --reload

# 2. å¯åŠ¨å‰ç«¯ (3001ç«¯å£)
cd frontend-v2
npm run dev
```

### å·¥ä½œæµæ¼”ç¤º

1. **è®¿é—®å‰ç«¯**: http://localhost:3001
2. **åˆ›å»ºè¯¾ç¨‹**: å¡«å†™è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯å¹¶æäº¤
3. **é˜¶æ®µ1**:
   - ç‚¹å‡»"å¼€å§‹ç”Ÿæˆ" â†’ AIç”Ÿæˆé¡¹ç›®åŸºç¡€å®šä¹‰(10-30ç§’)
   - æŸ¥çœ‹ç”Ÿæˆå†…å®¹ï¼Œç‚¹å‡»"ç¼–è¾‘"è¿›è¡Œä¿®æ”¹
   - ç‚¹å‡»"ç¡®è®¤å®Œæˆï¼Œç»§ç»­ä¸‹ä¸€é˜¶æ®µ"
4. **é˜¶æ®µ2**:
   - è‡ªåŠ¨ä½¿ç”¨ç¼–è¾‘åçš„Stage1å†…å®¹
   - ç‚¹å‡»"å¼€å§‹ç”Ÿæˆ" â†’ AIç”Ÿæˆè¯„ä¼°æ¡†æ¶(30-60ç§’)
   - æŸ¥çœ‹/ç¼–è¾‘ï¼Œç¡®è®¤å®Œæˆ
5. **é˜¶æ®µ3**:
   - ä½¿ç”¨Stage1+2çš„ç¼–è¾‘åå†…å®¹
   - ç”Ÿæˆå­¦ä¹ è“å›¾(60-90ç§’)
   - å®Œæˆåå¯å¯¼å‡ºMarkdownæ–‡ä»¶

---

## ğŸ“ æ ¸å¿ƒæ–‡ä»¶æ¸…å•

### åç«¯
```
backend/
â”œâ”€â”€ app/agents/stage_agents.py          # æ–°å¢ï¼š3ä¸ªç‹¬ç«‹Agent
â”œâ”€â”€ app/api/routes.py                   # ä¿®æ”¹ï¼šæ·»åŠ 3ä¸ªæ–°ç«¯ç‚¹(137-339è¡Œ)
â”œâ”€â”€ app/models/schemas.py               # ä¿®æ”¹ï¼šæ·»åŠ Stage1/2/3çš„Schema(81-144è¡Œ)
â”œâ”€â”€ test_full_workflow.py               # æ–°å¢ï¼šå®Œæ•´å·¥ä½œæµæµ‹è¯•
â””â”€â”€ test_stage1.py                      # æ–°å¢ï¼šStage1å•ç‹¬æµ‹è¯•
```

### å‰ç«¯
```
frontend-v2/
â”œâ”€â”€ src/services/api.ts                 # ä¿®æ”¹ï¼šæ·»åŠ åˆ†é˜¶æ®µAPIæ–¹æ³•å’Œç±»å‹(19-166è¡Œ)
â”œâ”€â”€ src/pages/CourseDesignPage.tsx      # å®Œå…¨é‡æ„ï¼šåˆ†é˜¶æ®µäººå·¥å‚ä¸å¼é¡µé¢(658è¡Œ)
â””â”€â”€ src/pages/CourseDesignPage_old_backup.tsx  # å¤‡ä»½ï¼šæ—§ç‰ˆä¸€æ¬¡æ€§ç”Ÿæˆé¡µé¢
```

---

## ğŸ”‘ å…³é”®æŠ€æœ¯å†³ç­–

### 1. Free-text Markdownæ ¼å¼
**åŸå› **: ç”¨æˆ·å‹å¥½ï¼Œæ˜“äºé˜…è¯»å’Œç¼–è¾‘ï¼Œæ— éœ€è§£æå¤æ‚JSONç»“æ„

**å®ç°**:
```python
# Agentè¿”å›
return {
    "success": True,
    "content": markdown_text,  # çº¯Markdownå­—ç¬¦ä¸²
    "generation_time": 12.22
}
```

### 2. é˜¶æ®µé—´æ˜¾å¼æ•°æ®ä¼ é€’
**åŸå› **: ç¡®ä¿ç”¨æˆ·ç¼–è¾‘çš„å†…å®¹æ­£ç¡®ä¼ é€’åˆ°ä¸‹ä¸€é˜¶æ®µ

**å®ç°**:
```typescript
// Stage2ä½¿ç”¨ç¼–è¾‘åçš„Stage1å†…å®¹
await apiService.generateStage2({
    driving_question: stage1Data.driving_question,  // ç”¨æˆ·å¯èƒ½å·²ç¼–è¾‘
    project_definition: stage1Data.project_definition,
    final_deliverable: stage1Data.final_deliverable,
    ...
})
```

### 3. çŠ¶æ€é©±åŠ¨çš„UIæ¸²æŸ“
**åŸå› **: æ¸…æ™°çš„çŠ¶æ€ç®¡ç†ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤

**çŠ¶æ€ç±»å‹**:
- `pending`: æœªå¼€å§‹
- `generating`: AIç”Ÿæˆä¸­
- `completed`: ç”Ÿæˆå®Œæˆï¼ˆåªè¯»ï¼‰
- `editing`: ç”¨æˆ·ç¼–è¾‘ä¸­
- `error`: ç”Ÿæˆå¤±è´¥

---

## âš ï¸ å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: å¤šåç«¯è¿›ç¨‹å¯¼è‡´æ—§ä»£ç è¿è¡Œ
**ç°è±¡**: ä¿®æ”¹ä»£ç åAPIä»è¿”å›æ—§é”™è¯¯
**æ ¹å› **: uv run uvicorn çš„ --reload ä¼šåˆ›å»ºçˆ¶å­è¿›ç¨‹ï¼ŒCtrl+Cä¸èƒ½å®Œå…¨æ€æ­»
**è§£å†³**: ä½¿ç”¨ `taskkill //F //IM python.exe` æ€æ‰æ‰€æœ‰Pythonè¿›ç¨‹åé‡å¯

### é—®é¢˜2: Stage1ç”Ÿæˆæ—¶é—´ä¸ç¨³å®š
**ç°è±¡**: 10-30ç§’æ³¢åŠ¨
**æ ¹å› **: AIæœåŠ¡å“åº”æ—¶é—´æ³¢åŠ¨
**ç¼“è§£**: å‰ç«¯æ˜¾ç¤º"é¢„è®¡éœ€è¦10-30ç§’"æç¤ºç”¨æˆ·è€å¿ƒç­‰å¾…

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| é˜¶æ®µ | å¹³å‡è€—æ—¶ | è¶…æ—¶è®¾ç½® | Tokenä½¿ç”¨(ä¼°ç®—) |
|-----|---------|----------|----------------|
| Stage 1 | 12-15ç§’ | 30ç§’ | ~500 tokens |
| Stage 2 | 35-45ç§’ | 60ç§’ | ~800 tokens |
| Stage 3 | 65-80ç§’ | 90ç§’ | ~1200 tokens |
| **æ€»è®¡** | **120-140ç§’** | **180ç§’** | **~2500 tokens** |

---

## ğŸ“ Linus è§†è§’çš„ä»£ç å®¡æŸ¥

### å¥½å“å‘³ä½“ç°

1. **æ•°æ®ç»“æ„ä¼˜å…ˆ**
   - æ¯ä¸ªStageçš„è¾“å…¥/è¾“å‡ºSchemaæ¸…æ™°å®šä¹‰
   - æ•°æ®æµå‘æ˜ç¡®: Stage1 â†’ Stage2 â†’ Stage3
   - æ²¡æœ‰ä¸å¿…è¦çš„ä¸­é—´è½¬æ¢

2. **æ¶ˆé™¤ç‰¹æ®Šæƒ…å†µ**
   - ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æ¨¡å¼
   - ä¸€è‡´çš„APIå“åº”æ ¼å¼
   - æ²¡æœ‰ç¡¬ç¼–ç çš„è¾¹ç•Œæ¡ä»¶

3. **ç®€æ´æ‰§å¿µ**
   - Agentä»£ç <100è¡Œ
   - æ¯ä¸ªå‡½æ•°åªåšä¸€ä»¶äº‹
   - çŠ¶æ€ç®¡ç†æ¸…æ™°(pending/generating/completed/editing/error)

### éœ€è¦æ”¹è¿›çš„åœ°æ–¹

1. **Stageé—´è€¦åˆåº¦**
   - å½“å‰Stage2/3éœ€è¦æ˜¾å¼ä¼ é€’Stage1æ•°æ®
   - å¯è€ƒè™‘å¼•å…¥Sessionç®¡ç†ï¼Œè‡ªåŠ¨ä¼ é€’ä¸Šä¸‹æ–‡

2. **é”™è¯¯æ¢å¤**
   - å½“å‰å¤±è´¥ååªèƒ½é‡è¯•æ•´ä¸ªé˜¶æ®µ
   - å¯è€ƒè™‘æ·»åŠ "ä»å¤±è´¥å¤„ç»§ç»­"åŠŸèƒ½

---

## ğŸš¦ ä¸‹ä¸€æ­¥å·¥ä½œå»ºè®®

### å¿…é¡»ä¼˜åŒ– (P0)
1. âŒ **ç”¨æˆ·çœŸäººæµ‹è¯•**: è®©çœŸå®ç”¨æˆ·ä½“éªŒå·¥ä½œæµï¼Œæ”¶é›†åé¦ˆ
2. âŒ **é”™è¯¯å¤„ç†å¢å¼º**: ç½‘ç»œå¼‚å¸¸ã€è¶…æ—¶åçš„å‹å¥½æç¤ºå’Œé‡è¯•æœºåˆ¶
3. âŒ **å†…å®¹æŒä¹…åŒ–**: æµè§ˆå™¨åˆ·æ–°åä¸ä¸¢å¤±å·²ç”Ÿæˆå†…å®¹(localStorage)

### åº”è¯¥ä¼˜åŒ– (P1)
4. âŒ **ç¼–è¾‘å†å²**: è®°å½•ç”¨æˆ·çš„ç¼–è¾‘æ“ä½œï¼Œæ”¯æŒ"æ’¤é”€"
5. âŒ **å¯¼å‡ºæ ¼å¼**: é™¤Markdownå¤–æ”¯æŒPDFã€DOCXå¯¼å‡º
6. âŒ **å“åº”å¼UI**: ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ

### å¯ä»¥ä¼˜åŒ– (P2)
7. âŒ **AIåŠ©æ‰‹èŠå¤©**: åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­æä¾›AIåŠ©æ‰‹å®æ—¶å¯¹è¯
8. âŒ **æ¨¡æ¿åº“**: é¢„è®¾å¸¸è§è¯¾ç¨‹ç±»å‹çš„æ¨¡æ¿å¿«é€Ÿå¼€å§‹
9. âŒ **åä½œåŠŸèƒ½**: å¤šç”¨æˆ·ååŒç¼–è¾‘åŒä¸€ä¸ªè¯¾ç¨‹

---

## ğŸ“ æ€»ç»“

### å®ç°äº†ä»€ä¹ˆ
âœ… **æ ¸å¿ƒç›®æ ‡è¾¾æˆ**: ä»ä¸€æ¬¡æ€§ç”Ÿæˆæ”¹é€ ä¸ºçœŸæ­£çš„åˆ†é˜¶æ®µäººå·¥å‚ä¸å¼å·¥ä½œæµ
âœ… **ç”¨æˆ·å¯ç¼–è¾‘**: æ¯ä¸ªé˜¶æ®µå®Œæˆåç”¨æˆ·å¯è‡ªç”±ç¼–è¾‘å†…å®¹
âœ… **æ•°æ®æµæ­£ç¡®**: ä¸‹ä¸€é˜¶æ®µä½¿ç”¨ä¸Šä¸€é˜¶æ®µç¼–è¾‘åçš„å†…å®¹
âœ… **å®Œæ•´åŠŸèƒ½**: ä»è¾“å…¥åˆ°å¯¼å‡ºçš„å®Œæ•´é—­ç¯

### æŠ€æœ¯äº®ç‚¹
- **ç®€æ´æ¶æ„**: Agentç‹¬ç«‹ã€APIæ¸…æ™°ã€çŠ¶æ€æ˜ç¡®
- **ç±»å‹å®‰å…¨**: TypeScriptå…¨ç¨‹ç±»å‹æ£€æŸ¥
- **ç”¨æˆ·å‹å¥½**: Markdownæ ¼å¼ã€å®æ—¶çŠ¶æ€æç¤ºã€å¯ç¼–è¾‘ç•Œé¢

### è´¨é‡ä¿è¯
- **ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡**: åç«¯3é˜¶æ®µä¸²è”æµ‹è¯•æˆåŠŸ
- **ç¼–è¯‘é›¶é”™è¯¯**: å‰ç«¯TypeScriptç¼–è¯‘æ— è­¦å‘Š
- **APIéªŒè¯é€šè¿‡**: æ‰‹åŠ¨curlæµ‹è¯•è¿”å›æ­£ç¡®æ•°æ®

---

**ğŸ‰ Phase 2.1 åˆ†é˜¶æ®µäººå·¥å‚ä¸å¼å·¥ä½œæµå·²å®Œæˆäº¤ä»˜ï¼**

**æœåŠ¡çŠ¶æ€**:
- âœ… åç«¯è¿è¡Œåœ¨ `http://localhost:8888`
- âœ… å‰ç«¯è¿è¡Œåœ¨ `http://localhost:3001`
- âœ… æ‰€æœ‰APIç«¯ç‚¹å·²éªŒè¯
- âœ… å‰ç«¯é¡µé¢å·²æ›´æ–°å¹¶ç¼–è¯‘æˆåŠŸ

**å‡†å¤‡å°±ç»ªï¼Œéšæ—¶å¯ä»¥æ¼”ç¤ºï¼**
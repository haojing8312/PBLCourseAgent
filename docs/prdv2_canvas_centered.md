### **产品设计文档 (PRD): Project Genesis AI - Phase 2 (Canvas-Centered)**

**文档版本:** 2.2
**状态:** 规划中
**核心主题:** Task-Driven Infinite Canvas (任务驱动的无限画布)
**架构理念:** 画布中心，对话辅助，可视化工作流

---

### **1.0 概述与战略调整 (Overview & Strategic Shift)**

#### **1.1 复盘与现状**
第一阶段的MVP成功验证了产品的核心价值——能够将用户想法转化为结构化的PBL课程方案（JSON）。当前，我们拥有一个功能可用的"后端引擎"。

#### **1.2 第二阶段核心战略**
第二阶段将进行重大战略聚焦，采用现代AI Agent产品的主流设计模式（如Flowise.ai、Lovart）。我们的目标是打造一个**以无限画布为中心、任务节点为驱动、对话为辅助的可视化创作环境**。所有功能设计将围绕以下核心原则：
* **画布中心:** 主要交互发生在无限画布上，通过任务节点组织工作流程。
* **任务驱动:** 将课程设计拆解为可视化的任务节点，用户通过完成节点任务推进整体进度。
* **对话辅助:** 对话作为辅助工具，与画布节点实时同步，提供上下文相关的AI支持。
* **工作流可视化:** 整个创作过程以工作流图的形式呈现，进度和依赖关系一目了然。

---

### **2.0 第二阶段目标与成功指标 (Goals & Success Metrics)**

#### **2.1 产品目标**
1. **打造沉浸式可视化创作流:** 将课程设计从"表单填写"升级为"可视化工作流构建"的沉浸式体验。
2. **提升任务清晰度:** 通过任务节点的方式让用户清楚了解每个步骤的目标和产出物。
3. **实现智能任务编排:** 系统能够智能分析用户需求，自动生成合理的任务工作流。
4. **奠定开源社区基础:** 发布一个功能强大、体验优越的初始版本，吸引早期贡献者和用户。

#### **2.2 成功指标 (KPIs)**
* **核心功能完成度:** 100%实现PRD中定义的核心功能。
* **用户体验指标:** 任务节点点击到AI响应的首字符时间 < 1.5秒。
* **可视化效果:** 画布能够清晰展示不少于10个任务节点的复杂工作流。
* **社区反馈:** 在代码托管平台（如GitHub）上获得积极的反馈。

---

### **3.0 核心功能详述 (Core Features)**

第二阶段的核心是一个统一的功能体——**"任务驱动的无限画布" (Task-Driven Infinite Canvas)**，它采用现代AI Agent产品的主流设计模式，以画布为中心，任务节点为驱动，对话为辅助的交互架构。

#### **EPIC 1: 全新交互界面 - "任务驱动的无限画布"**

* **新增与优化:** 这是本阶段最重要的升级。我们将采用类似Flowise.ai、Lovart等产品级Agent的无限画布架构，提供以任务节点为核心的可视化创作环境。
* **用户故事:**
    > "我希望能在一个无限画布上看到我的PBL课程设计任务被拆解成多个节点，每个节点代表一个具体任务（如'生成驱动性问题'），我可以通过与AI对话来逐步完成这些节点，最终形成完整的课程方案。整个过程就像搭建一个可视化的工作流程。"
* **功能需求:**
    * **FR-1.1 (会话管理):**
        * 应用启动后即为一个全新的、匿名的**"课程设计会话 (Course Design Session)"**。
        * 提供"开始新会话"按钮，可随时清空当前画布和对话，开启一个新的课程设计。
        * (可选增强) 利用浏览器`localStorage`在本地暂存当前会话，用户关闭浏览器再打开时可恢复上次的创作进度。
    * **FR-1.2 (画布中心布局):**
        * **中心区域为"无限画布":** 这是主要的工作区域，展示任务节点、连接线和生成内容。
        * **右侧为"对话侧边栏":** 用户在此处与AI进行问答和指令交互，侧边栏可折叠/展开。
        * **左上角为"任务面板":** 显示当前任务进度、待完成任务列表等状态信息。
    * **FR-1.3 (任务节点系统):**
        * 画布上以**任务节点**的形式组织课程设计流程，包括但不限于：
            * 📋 "项目基础定义" 节点（包含驱动性问题、最终成果等子任务）
            * 📊 "评估框架设计" 节点（包含量规设计、检查点设置等子任务）
            * 📚 "学习蓝图生成" 节点（包含时间线、活动设计等子任务）
            * 🎯 "教学资源创建" 节点（包含开场白、指导手册等子任务）
        * 节点之间通过**连接线**显示依赖关系和执行顺序。
        * 每个节点有明确的状态：待开始、进行中、已完成、需优化。
    * **FR-1.4 (节点-对话交互):**
        * 当用户点击任务节点时，右侧对话区自动聚焦到该任务，并显示相关的提示和上下文。
        * AI在对话过程中实时更新节点内容，**流式生成**的内容直接渲染到对应节点内部。
        * 对话区显示当前任务进度，如"正在生成驱动性问题..."，画布上对应节点同步显示加载状态。

#### **EPIC 2: 智能任务编排 - "可视化工作流"**

* **新增功能:** 系统智能分析用户输入，自动生成任务工作流，用户可以选择顺序执行或并行处理多个任务节点。
* **用户故事:**
    > "我希望系统能够理解我的课程需求，自动为我规划出一个清晰的任务流程图。我可以看到哪些任务是前置条件，哪些可以并行进行，整个设计过程一目了然。"
* **功能需求:**
    * **FR-2.1 (智能任务分解):** 基于用户的初始输入（课程主题、概要等），AI自动生成完整的任务节点图谱。
    * **FR-2.2 (工作流可视化):**
        * 任务节点按逻辑顺序在画布上自动排列，形成清晰的工作流。
        * 节点间的依赖关系通过箭头连接线表示。
        * 支持任务节点的拖拽重排和手动调整。
    * **FR-2.3 (任务状态管理):**
        * 实时跟踪每个任务节点的完成状态。
        * 支持任务的暂停、重做、跳过等操作。
        * 显示整体进度条和预计完成时间。

#### **EPIC 3: 多维度交付 - "画布导出"与"结构化文档"**

* **新增与优化:** 提供画布快照导出和结构化文档导出两种模式，满足不同场景的使用需求。
* **功能需求:**
    * **FR-3.1 (画布快照导出):**
        * 提供"导出画布为图片"功能，支持PNG/SVG格式。
        * 支持选择导出区域或整个画布。
        * 保持高分辨率，适合演示和分享。
    * **FR-3.2 (结构化文档导出):**
        * 提供"导出为.docx"和"导出为.pdf"按钮。
        * 将画布上的任务节点内容按逻辑顺序重新组织成传统文档格式。
        * **必须解决中文字体在导出过程中的乱码或格式错乱问题。**
    * **FR-3.3 (应用打包与部署):**
        * 整个应用（前端+后端）将被打包成一个**Docker容器**。
        * 需提供一份极其清晰的`README.md`文档，包含：
            * 项目简介和功能截图。
            * 如何在本地配置LLM的API Key（作为环境变量）。
            * 一行命令即可启动应用的Docker指令（例如 `docker-compose up -d`）。
            * 确保整个部署过程对于一个有基础的开发者来说，不超过10分钟。

---

### **4.0 范围之外 (Out of Scope for Phase 2)**

* **用户账户系统及所有云端同步功能。**
* **RAG及任何外部知识库的集成。**
* **多人实时协作功能（可作为后续迭代）。**
* **任务节点的自定义模板系统（可作为后续迭代）。**
* **在线支付与商业化功能。**
* **画布内容的富文本在线编辑（可作为后续迭代）。**

---

### **5.0 技术架构亮点**

#### **5.1 无限画布技术选型**
* **核心技术:** tldraw SDK - 生产级无限画布解决方案
* **实时协作:** 支持多用户实时协作（为后续扩展预留）
* **性能优化:** 支持大量节点的流畅渲染和交互

#### **5.2 对话系统集成**
* **流式通信:** assistant-ui提供的企业级AI对话组件
* **状态同步:** 对话状态与画布节点状态实时同步
* **上下文管理:** 智能的任务上下文切换和保持

#### **5.3 任务节点设计**
* **节点类型:** 预定义的课程设计任务节点类型
* **状态机:** 清晰的节点状态转换逻辑
* **扩展性:** 支持自定义节点类型的架构设计

---

**文档维护者:** Claude Code
**最后更新:** 2025-09-29
**审核状态:** 待审核
### **产品设计文档 (PRD): PBLCourseAgent - Phase 2 (Guided Canvas-Driven)**

**文档版本:** 2.3
**状态:** 已实现
**核心主题:** 引导式课程创建 + 自动化画布工作流
**架构理念:** 引导式信息收集，自动化节点创建，阶段性确认机制

---

### **1.0 概述与产品设计思路 (Overview & Product Design Philosophy)**

#### **1.1 产品核心理念**
PBLCourseAgent 是一款AI驱动的引导式PBL课程设计助手。不同于传统的自由对话或表单填写模式，我们采用了一种**结构化引导 + 自动化画布**的创新设计模式。

#### **1.2 核心设计思路**
产品采用三步骤引导式工作流，确保用户体验的流畅性和结果的专业性：

**第一步：明确入口**
- 用户点击"创建新课程"，明确表达创建意图
- 避免用户在首页迷茫，提供清晰的产品价值和操作指导

**第二步：AI结构化引导**
- AI助手按照固定的7个维度收集课程信息：课程类型、主题、描述、学生年龄、人数、周期、特殊要求
- 左侧实时预览收集进度，右侧AI逐步引导，确保信息收集的完整性
- 避免用户不知道该输入什么信息的困扰

**第三步：自动化创建 + 阶段确认**
- 基于收集的信息，自动在画布上创建主节点和三个阶段子节点
- AI自动生成每个阶段的专业内容（项目基础定义、评估框架、学习蓝图）
- 每个阶段完成后弹出确认机制，用户可以修改或继续下一阶段

#### **1.3 设计原则**
* **引导式体验:** 用户无需思考下一步做什么，系统主动引导整个流程
* **可视化呈现:** 画布自动创建节点，让抽象的课程设计变得具象可见
* **专业性保障:** AI生成的内容基于PBL教学法的专业框架
* **阶段性确认:** 每个关键节点都有确认机制，确保用户满意度

---

### **2.0 第二阶段目标与成功指标 (Goals & Success Metrics)**

#### **2.1 产品目标**
1. **打造沉浸式可视化创作流:** 将课程设计从"表单填写"升级为"可视化工作流构建"的沉浸式体验。
2. **提升任务清晰度:** 通过任务节点的方式让用户清楚了解每个步骤的目标和产出物。
3. **实现智能任务编排:** 系统能够智能分析用户需求，自动生成合理的任务工作流。
4. **奠定开源社区基础:** 发布一个功能强大、体验优越的初始版本，吸引早期贡献者和用户。

#### **2.2 成功指标 (KPIs)**
* **核心功能完成度:** 100%实现PRD中定义的核心功能。
* **用户体验指标:** 任务节点点击到AI响应的首字符时间 < 1.5秒。
* **可视化效果:** 画布能够清晰展示不少于10个任务节点的复杂工作流。
* **社区反馈:** 在代码托管平台（如GitHub）上获得积极的反馈。

---

### **3.0 核心功能详述 (Core Features)**

产品采用**三页面引导式架构**，通过明确的流程引导用户完成专业的PBL课程设计。每个页面都有明确的目标和转换条件，确保用户体验的连贯性。

#### **页面1: 欢迎页面 (`/`)**

**设计目标:** 提供明确的产品价值和创建入口，避免用户迷茫

**功能需求:**
* **FR-1.1 产品介绍展示:**
  * 清晰的产品标题："PBLCourseAgent - AI驱动的PBL课程设计助手"
  * 核心价值说明："通过AI助手引导，快速创建高质量的项目式学习课程"
  * 三步骤流程说明：信息收集 → 自动创建 → 确认完善
* **FR-1.2 核心行动按钮:**
  * 突出的"创建新课程"按钮，作为主要行动召唤
  * 点击后跳转到课程信息收集页面 (`/create`)
* **FR-1.3 特性展示:**
  * 智能引导设计、个性化定制、高效创建三大特点
  * 使用流程的可视化说明

#### **页面2: 课程信息收集页面 (`/create`)**

**设计目标:** 通过AI引导式对话，结构化收集课程设计所需的核心信息

**布局设计:**
* **左侧（1/3宽度）:** 信息预览区，实时显示收集进度和已填写内容
* **右侧（2/3宽度）:** AI引导对话区，逐步收集信息

**功能需求:**
* **FR-2.1 AI引导收集流程:**
  * 固定的7个信息收集步骤：
    1. 课程类型（STEM、人文社科、艺术创作、综合实践）
    2. 课程主题（具体的主题描述）
    3. 课程描述（内容和目标说明）
    4. 学生年龄（目标学生的年龄）
    5. 学生人数（参与课程的人数）
    6. 课程周期（时间安排）
    7. 特殊要求（设备、环境等）
* **FR-2.2 进度可视化:**
  * 左侧实时显示收集进度（已完成/总数）
  * 每个信息项显示完成状态和具体内容
  * 整体进度条显示完成百分比
* **FR-2.3 交互体验:**
  * AI按顺序提出问题，用户回答后自动进入下一个问题
  * 收集完成后显示"开始创建课程"按钮
  * 点击跳转到设计工作台页面 (`/design`)

#### **页面3: 课程设计工作台 (`/design`)**

**设计目标:** 自动化创建课程节点，通过三阶段工作流生成完整的PBL课程方案

**布局设计:**
* **左侧:** 无限画布区域，自动创建和更新课程节点
* **右侧:** AI对话窗口（可展开/收起）
* **顶部:** 工作流进度指示器

**功能需求:**
* **FR-3.1 自动节点创建:**
  * 基于收集的信息，自动创建主节点：`{课程主题} PBL课程研发任务`
  * 自动创建三个子节点：
    - 项目基础定义（灰色，待执行）
    - 评估框架设计（灰色，待执行）
    - 学习蓝图生成（灰色，待执行）
  * 节点间用连接线表示执行顺序
* **FR-3.2 三阶段自动化工作流:**
  * **阶段1 - 项目基础定义:**
    - AI根据用户输入生成驱动性问题、学习目标、项目成果
    - 节点颜色变为蓝色（进行中），完成后变绿色（已完成）
    - 弹出确认对话框显示生成内容
  * **阶段2 - 评估框架设计:**
    - AI生成评估维度、评估方法、评估时间节点
    - 同样的状态变化和确认机制
  * **阶段3 - 学习蓝图生成:**
    - AI生成详细的课程实施计划、资源需求、教师指导要点
    - 最终确认完成整个课程方案
* **FR-3.3 阶段确认机制:**
  * 每个阶段完成后弹出模态框显示AI生成的内容
  * 提供"修改内容"和"确认继续"两个选择
  * 用户确认后进入下一阶段，直到完成所有阶段

### **4.0 用户体验流程 (User Experience Flow)**

#### **完整用户旅程:**

```
用户访问产品首页 (/)
    ↓
查看产品介绍和价值说明
    ↓ 点击"创建新课程"
进入信息收集页面 (/create)
    ↓
AI引导式收集7个维度信息
    ↓ 信息收集完成
点击"开始创建课程"
    ↓
进入设计工作台 (/design)
    ↓
自动创建主节点和三个子节点
    ↓ 点击"开始工作流"
自动执行三阶段创建流程:
    ↓
阶段1: AI生成项目基础定义
    ↓ 弹出确认框 [修改] vs [继续]
阶段2: AI生成评估框架
    ↓ 弹出确认框 [修改] vs [继续]
阶段3: AI生成学习蓝图
    ↓ 弹出确认框 [修改] vs [完成]
✅ 完整PBL课程方案生成完成
```

#### **关键交互设计:**

* **信息收集阶段:** 左右分栏设计，进度可视化，AI主动引导
* **工作台阶段:** 画布自动布局，节点状态实时更新，模态框确认机制
* **确认机制:** 每个阶段都有明确的确认点，保证用户满意度

### **5.0 技术实现架构**

#### **5.1 前端技术栈**
* **框架:** React 18 + TypeScript + Vite
* **路由:** React Router v6 - 支持三页面导航
* **画布:** tldraw 4.0+ - 无限画布和自动节点创建
* **状态管理:** Zustand - 轻量级应用状态管理
* **UI组件:** Tailwind CSS + Lucide React Icons

#### **5.2 后端技术栈**
* **框架:** Python 3.10+ + FastAPI
* **AI集成:** OpenAI-compatible API 支持多种LLM
* **数据管理:** Pydantic 数据验证和序列化
* **环境管理:** 专用环境变量命名避免冲突

#### **5.3 关键技术实现**
* **自动节点创建:** 基于tldraw API的程序化节点生成
* **状态同步:** 工作流状态与画布节点状态实时同步
* **阶段性内容生成:** 基于用户输入的智能内容生成
* **确认机制:** 模态框交互和状态管理

---

### **6.0 范围之外 (Out of Scope for Phase 2)**

以下功能在当前阶段不实现，可作为后续迭代考虑：

* **用户账户系统** - 当前采用本地会话模式
* **多人实时协作** - 当前为单用户创作模式
* **课程模板库** - 当前基于AI实时生成
* **富文本编辑器** - 当前使用纯文本显示
* **导出功能** - 当前专注于创建流程
* **历史版本管理** - 当前为一次性创建模式

### **7.0 质量标准与错误处理**

#### **7.1 错误处理质量理念**
**核心原则：透明性胜过降级回复**

产品遵循严格的错误处理标准：
* **透明性：** 用户总是知道真实状态，不掩盖错误
* **准确性：** 成功就是真正的AI回复，失败就是明确的错误信息
* **可维护性：** 开发者能快速定位问题根因
* **用户体验：** 用户不会被虚假的"成功"误导

**严禁的做法：**
- ❌ 降级回复掩盖真实错误
- ❌ 返回低质量内容假装成功
- ❌ 隐藏具体错误详情

**正确的做法：**
- ✅ 直接返回 `success: false` 和具体错误信息
- ✅ 在前端明确显示错误状态和详情
- ✅ 提供足够信息让用户/开发者定位问题
- ✅ 保持服务质量的一致性：要么高质量成功，要么明确失败

#### **7.2 性能标准**
* **页面加载时间:** < 2秒
* **AI响应时间:** 首字符 < 3秒
* **节点创建响应:** < 1秒
* **页面间切换:** < 500ms

### **8.0 部署与环境配置**

#### **8.1 开发环境**
```bash
# 后端启动
cd backend && uv run uvicorn app.main:app --host 127.0.0.1 --port 8001 --reload

# 前端启动
cd frontend-v2 && npm run dev
```

#### **8.2 环境变量配置**
为避免冲突，使用专用环境变量名：
```
PBL_AI_API_KEY=your_api_key
PBL_AI_MODEL=deepseek-chat
PBL_AI_BASE_URL=http://your-api-endpoint/v1
```

---

### **9.0 实现状态**

**✅ 已完成功能：**
- 三页面引导式架构 (`/`, `/create`, `/design`)
- AI结构化信息收集（7个维度）
- 自动化画布节点创建和布局
- 三阶段工作流自动执行
- 阶段性确认机制
- 透明化错误处理
- React Router导航系统

**🚀 当前可体验地址：**
- 产品入口：http://localhost:3002
- 完整工作流验证：首页 → 创建 → 设计 → 工作流

---

**文档维护者:** Claude Code
**最后更新:** 2025-09-29
**实现状态:** ✅ Phase 2 核心功能已完成
**审核状态:** 已按实际产品设计更新